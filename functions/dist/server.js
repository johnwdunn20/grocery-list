"use strict";var _path=_interopRequireDefault(require("path"));var _express=_interopRequireDefault(require("express"));var _cookieParser=_interopRequireDefault(require("cookie-parser"));var _cors=_interopRequireDefault(require("cors"));var _database=_interopRequireDefault(require("./controllers/database"));var _auth=_interopRequireDefault(require("./controllers/auth"));var _openAi=_interopRequireDefault(require("./controllers/openAi"));require("dotenv/config");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:String(i)}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var PORT=process.env.PORT||3000;var app=(0,_express["default"])();app.use(_express["default"]["static"](_path["default"].join(__dirname,"../../client/dist")));app.use(_express["default"].json());app.use(_express["default"].urlencoded({extended:true}));app.use((0,_cookieParser["default"])());app.use((0,_cors["default"])({origin:"*"}));var apiRouter=_express["default"].Router();app.use("/api",apiRouter);apiRouter.get("/groceries",_auth["default"].isLoggedIn,_database["default"].getGroceries,function(req,res){return res.status(200).json(res.locals.groceries)});apiRouter.post("/addItem",_openAi["default"].getCategory,_auth["default"].isLoggedIn,_database["default"].addItem,function(req,res){console.log(req.body.newItem);return res.status(200).json(res.locals.category)});apiRouter.post("/category",_openAi["default"].getCategory,function(req,res){return res.status(200).json(res.locals.category)});apiRouter["delete"]("/deleteItem",_auth["default"].isLoggedIn,_database["default"].deleteItem,function(req,res){var id=req.params.id;console.log("id: ",id);res.status(200).json(res.locals.deletedItem)});apiRouter.patch("/toggleCheck",_auth["default"].isLoggedIn,_database["default"].toggleCheck,function(req,res){return res.status(200).json(res.locals.updatedItem)});apiRouter.post("/clearFound",_auth["default"].isLoggedIn,_database["default"].clearFound,function(req,res){return res.sendStatus(200)});apiRouter.post("/clearAll",_auth["default"].isLoggedIn,_database["default"].clearAll,function(req,res){return res.sendStatus(200)});apiRouter.post("/login",_auth["default"].login,function(req,res){return res.status(200).json(res.locals.id)});apiRouter.post("/signup",_auth["default"].signup,function(req,res){return res.status(200).json(res.locals.id)});apiRouter.post("/logout",_auth["default"].logout,function(req,res){return res.status(200).send("Logged out")});apiRouter.get("/isLoggedIn",_auth["default"].isLoggedIn,function(req,res){return res.status(200).json(res.locals.name)});app.get("/login",function(req,res){res.sendFile(_path["default"].join(__dirname,"../../client/dist/index.html"))});app.get("/signup",function(req,res){res.sendFile(_path["default"].join(__dirname,"../../client/dist/index.html"))});app.get("/resetpassword",function(req,res){res.sendFile(_path["default"].join(__dirname,"../../client/dist/index.html"))});app.use("*",function(req,res){return res.status(400).send("The page you are looking for was not found")});app.use(function(err,req,res,next){var defaultErr={log:"Express error handler caught unknown middleware error",status:500,message:{err:"An error occurred"}};var errorObj=_objectSpread(_objectSpread({},defaultErr),err);console.log(errorObj.log);return res.status(errorObj.status).json(errorObj.message)});app.listen(PORT,function(){console.log("Server listening on port: ".concat(PORT,"..."))});module.exports=app;